<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.RoomMapper">
	<insert id="roomAdd" parameterType="ReqRoomAdd" useGeneratedKeys="true" keyColumn="room_sid" keyProperty="room_sid" >
        INSERT INTO tb_room (
        room_info, 
        delete_yn,
        created_date,
        modified_date
        ) VALUES (
        #{room_info}, 
        'N',
        now(),
        now()
        )
    </insert>
	<insert id="addOptions" parameterType="com.example.demo.dto.request.room.ReqOptions">
		INSERT INTO tb_options(
			room_sid,
			option_name,
			option_value
		) VALUES (
			#{room_sid},
			#{option_name},
			#{option_value}
		)
	</insert>
	<insert id ="uploadImg" parameterType="RoomImg">
		INSERT INTO tb_room_img(
			room_sid,
			original_name,
			img_name,
			extension
		) VALUES (
			#{room_sid},
			#{original_name},
			#{img_name},
			#{extension}
		)
	</insert>
	
	<resultMap type="ResRoomList" id="resultList">
		<id property="room_sid" column="room_sid" />
		<result property="room_info" column="room_info" />
		<collection property="options" resultMap="optionsMap"></collection>
		<collection property="images" resultMap="imagesMap"></collection>
	</resultMap>
	
	<resultMap type="ResRoomImg" id="imagesMap">
		<result property="room_sid" column="room_sid"/>
		<result property="original_name" column="original_name"/>
		<result property="img_name" column="img_name"/>
	</resultMap>
	
	<resultMap type="ResOptions" id="optionsMap">
		<result property="room_sid" column="room_sid" />
		<result property="option_name" column="option_name" />
		<result property="option_value" column="option_value" />
	</resultMap>
	
	<select id="roomList" resultMap="resultList">
		SELECT 	
				TR.* ,
				OP.option_name ,	OP.option_value,
				TI.original_name,	TI.img_name
		FROM	
				tb_room AS TR
				
		LEFT OUTER JOIN 	tb_options		AS	OP	ON 	TR.room_sid = OP.room_sid
		LEFT OUTER JOIN 	tb_room_img	AS	TI		ON 	TR.room_sid = TI.room_sid
		
		WHERE	
				TR.delete_yn = 'N'
		ORDER BY
				TR.room_sid DESC;
	</select>
</mapper> 